import { Injectable, OnModuleInit } from '@nestjs/common';
import { EventBus } from '@nestjs/cqrs';
import { RatesServiceProviderBase } from './rates.service.provider.base';
import { waitMiliseconds } from '../../core/util/wait-ms';

@Injectable()
export class RatesServiceMock extends RatesServiceProviderBase implements OnModuleInit {
  constructor(
    readonly eventBus: EventBus,
  ) {
    super(eventBus);
  }

  onModuleInit() {
    this.initRates();

    this.startRatesMockCycle();
  }

  // region Private Methods

  protected async startRatesMockCycle() {
    while (true) {
      this.updateEurRatesFromDTO(getDtoForUpdateEurRates());
      this.updateRatesFromDTO(getDtoForUpdateRates());
      await waitMiliseconds(15 * 1000);
    }
  }

  protected initRates() {
    this.updateEurRatesFromDTO(getDtoForUpdateEurRates());
    this.updateRatesFromDTO(getDtoForUpdateRates());
  }

  // endregion
}

// region Helper Functions

function getDtoForUpdateEurRates() {
  return {
    values: [
      {currency: 'AED', value: '4.101847'},
      {currency: 'AFN', value: '88.502409'},
      {currency: 'ALL', value: '122.957963'},
      {currency: 'AMD', value: '535.724855'},
      {currency: 'ANG', value: '2.09384'},
      {currency: 'AOA', value: '364.74477'},
      {currency: 'ARS', value: '50.204387'},
      {currency: 'AUD', value: '1.627436'},
      {currency: 'AWG', value: '2.010697'},
      {currency: 'AZN', value: '1.904094'},
      {currency: 'BAM', value: '1.955698'},
      {currency: 'BBD', value: '2.235219'},
      {currency: 'BDT', value: '94.08349'},
      {currency: 'BGN', value: '1.95788'},
      {currency: 'BHD', value: '0.421074'},
      {currency: 'BIF', value: '2060.392578'},
      {currency: 'BMD', value: '1.116744'},
      {currency: 'BND', value: '1.508279'},
      {currency: 'BOB', value: '7.716422'},
      {currency: 'BRL', value: '4.577761'},
      {currency: 'BSD', value: '1.116911'},
      {currency: 'BTC', value: '0.0001519441609861627'},
      {currency: 'BTN', value: '78.51319'},
      {currency: 'BWP', value: '12.008393'},
      {currency: 'BYN', value: '2.327016'},
      {currency: 'BYR', value: '21888.181318'},
      {currency: 'BZD', value: '2.250965'},
      {currency: 'CAD', value: '1.504199'},
      {currency: 'CDF', value: '1848.211633'},
      {currency: 'CHF', value: '1.128861'},
      {currency: 'CLF', value: '0.028217'},
      {currency: 'CLP', value: '778.599507'},
      {currency: 'CNY', value: '7.726309'},
      {currency: 'COP', value: '3709.265013'},
      {currency: 'CRC', value: '654.122039'},
      {currency: 'CUC', value: '1.116744'},
      {currency: 'CUP', value: '29.593715'},
      {currency: 'CVE', value: '110.725602'},
      {currency: 'CZK', value: '25.77345'},
      {currency: 'DJF', value: '198.468173'},
      {currency: 'DKK', value: '7.47426'},
      {currency: 'DOP', value: '56.623258'},
      {currency: 'DZD', value: '133.529512'},
      {currency: 'EGP', value: '19.017596'},
      {currency: 'ERN', value: '16.751559'},
      {currency: 'ETB', value: '32.413538'},
      {currency: 'EUR', value: '1'},
      {currency: 'FJD', value: '2.406628'},
      {currency: 'FKP', value: '0.875427'},
      {currency: 'GBP', value: '0.878085'},
      {currency: 'GEL', value: '3.065507'},
      {currency: 'GGP', value: '0.877999'},
      {currency: 'GHS', value: '31.92217'},
      {currency: 'GIP', value: '0.875427'},
      {currency: 'GMD', value: '55.335098'},
      {currency: 'GNF', value: '10307.547008'},
      {currency: 'GTQ', value: '8.55398'},
      {currency: 'GYD', value: '233.728969'},
      {currency: 'HKD', value: '8.766385'},
      {currency: 'HNL', value: '26.322089'},
      {currency: 'HRK', value: '7.435337'},
      {currency: 'HTG', value: '98.255045'},
      {currency: 'HUF', value: '326.246009'},
      {currency: 'IDR', value: '16203.954639'},
      {currency: 'ILS', value: '3.988567'},
      {currency: 'IMP', value: '0.877999'},
      {currency: 'INR', value: '78.560747'},
      {currency: 'IQD', value: '1328.925294'},
      {currency: 'IRR', value: '47020.50419'},
      {currency: 'ISK', value: '137.21476'},
      {currency: 'JEP', value: '0.877999'},
      {currency: 'JMD', value: '151.099712'},
      {currency: 'JOD', value: '0.791816'},
      {currency: 'JPY', value: '122.925634'},
      {currency: 'KES', value: '113.018735'},
      {currency: 'KGS', value: '78.004994'},
      {currency: 'KHR', value: '4533.980808'},
      {currency: 'KMF', value: '492.875369'},
      {currency: 'KPW', value: '1005.043386'},
      {currency: 'KRW', value: '1334.219089'},
      {currency: 'KWD', value: '0.33977'},
      {currency: 'KYD', value: '0.930673'},
      {currency: 'KZT', value: '424.095108'},
      {currency: 'LAK', value: '9634.712607'},
      {currency: 'LBP', value: '1683.495717'},
      {currency: 'LKR', value: '196.33518'},
      {currency: 'LRD', value: '201.963569'},
      {currency: 'LSL', value: '16.126209'},
      {currency: 'LTL', value: '3.297455'},
      {currency: 'LVL', value: '0.675508'},
      {currency: 'LYD', value: '1.552699'},
      {currency: 'MAD', value: '10.800594'},
      {currency: 'MDL', value: '20.017081'},
      {currency: 'MGA', value: '4053.780907'},
      {currency: 'MKD', value: '61.56554'},
      {currency: 'MMK', value: '1714.764518'},
      {currency: 'MNT', value: '2923.030789'},
      {currency: 'MOP', value: '9.028261'},
      {currency: 'MRO', value: '398.677974'},
      {currency: 'MUR', value: '39.545583'},
      {currency: 'MVR', value: '17.202035'},
      {currency: 'MWK', value: '802.3847'},
      {currency: 'MXN', value: '21.392686'},
      {currency: 'MYR', value: '4.663566'},
      {currency: 'MZN', value: '70.985872'},
      {currency: 'NAD', value: '66.351385'},
      {currency: 'NGN', value: '402.590354'},
      {currency: 'NIO', value: '37.009315'},
      {currency: 'NOK', value: '9.820689'},
      {currency: 'NPR', value: '125.399598'},
      {currency: 'NZD', value: '1.712012'},
      {currency: 'OMR', value: '0.430064'},
      {currency: 'PAB', value: '1.1168'},
      {currency: 'PEN', value: '3.72267'},
      {currency: 'PGK', value: '3.771807'},
      {currency: 'PHP', value: '58.835698'},
      {currency: 'PKR', value: '165.505588'},
      {currency: 'PLN', value: '4.307673'},
      {currency: 'PYG', value: '7017.399731'},
      {currency: 'QAR', value: '4.066108'},
      {currency: 'RON', value: '4.765189'},
      {currency: 'RSD', value: '118.062587'},
      {currency: 'RUB', value: '72.314797'},
      {currency: 'RWF', value: '1005.06955'},
      {currency: 'SAR', value: '4.187958'},
      {currency: 'SBD', value: '9.166067'},
      {currency: 'SCR', value: '15.314472'},
      {currency: 'SDG', value: '50.374129'},
      {currency: 'SEK', value: '10.767203'},
      {currency: 'SGD', value: '1.538207'},
      {currency: 'SHP', value: '1.475111'},
      {currency: 'SLL', value: '9911.102888'},
      {currency: 'SOS', value: '650.507443'},
      {currency: 'SRD', value: '8.328719'},
      {currency: 'STD', value: '23508.129649'},
      {currency: 'SVC', value: '9.771737'},
      {currency: 'SYP', value: '575.123509'},
      {currency: 'SZL', value: '16.126195'},
      {currency: 'THB', value: '35.544885'},
      {currency: 'TJS', value: '10.538605'},
      {currency: 'TMT', value: '3.919771'},
      {currency: 'TND', value: '3.345486'},
      {currency: 'TOP', value: '2.5641'},
      {currency: 'TRY', value: '6.762336'},
      {currency: 'TTD', value: '7.528362'},
      {currency: 'TWD', value: '35.043836'},
      {currency: 'TZS', value: '2574.095168'},
      {currency: 'UAH', value: '29.434062'},
      {currency: 'UGX', value: '4195.499381'},
      {currency: 'USD', value: '1.116744'},
      {currency: 'UYU', value: '39.354466'},
      {currency: 'UZS', value: '9442.572998'},
      {currency: 'VEF', value: '11.153484'},
      {currency: 'VND', value: '26123.432729'},
      {currency: 'VUV', value: '125.07328'},
      {currency: 'WST', value: '3.000334'},
      {currency: 'XAF', value: '655.942299'},
      {currency: 'XAG', value: '0.077458'},
      {currency: 'XAU', value: '0.000874'},
      {currency: 'XCD', value: '3.018057'},
      {currency: 'XDR', value: '0.809816'},
      {currency: 'XOF', value: '653.295579'},
      {currency: 'XPF', value: '119.771195'},
      {currency: 'YER', value: '279.577253'},
      {currency: 'ZAR', value: '16.127574'},
      {currency: 'ZMK', value: '10052.039609'},
      {currency: 'ZMW', value: '15.405524'},
      {currency: 'ZWL', value: '359.988007'},
      {currency: 'ETH', value: '0.00470543125767256975'},
      {currency: 'XRP', value: '2.97933463169970386575'},
      {currency: 'BCH', value: '0.00309895333762883272'},
      {currency: 'LTC', value: '0.01269639729619572169'},
      {currency: 'EOS', value: '0.18834966521057158759'},
      {currency: 'BNB', value: '0.04160414989421480337'},
      {currency: 'USDT', value: '1.116744'},
      {currency: 'XLM', value: '8.29367991088005941329'},
      {currency: 'ADA', value: '13.78696296296296296296'},
      {currency: 'TRX', value: '41.49921962095875139353'},
      {currency: 'XMR', value: '0.0137975001649407807'},
      {currency: 'DASH', value: '0.00808894929507153444'},
      {currency: 'BSV', value: '0.01864749769858502011'},
      {currency: 'IOT', value: '2.87331858179385581228'},
      {currency: 'XTZ', value: '0.6813444537317803823'},
      {currency: 'ETC', value: '0.15301069950277249889'},
      {currency: 'NEO', value: '0.1025480350708358892'},
      {currency: 'ONT', value: '0.83392002389575476982'},
      {currency: 'MKR', value: '0.00177514558696118161'},
    ],
  };
}

function getDtoForUpdateRates() {
  return {
    bid: {
      'BTC-EUR': '5332.504',
      'EUR-BTC': '0.000184723333767611532375',
      'ETH-EUR': '148.3192',
      'EUR-ETH': '0.006640128453870341875125',
      'LTC-EUR': '64.681225',
      'EUR-LTC': '0.015199081163859111796275',
      'REP-EUR': '17.14246',
      'EUR-REP': '0.057300386813694359445225',
      'XRP-EUR': '0.260858775',
      'EUR-XRP': '3.77276010187402592466235',
      'BCH-EUR': '248.3235',
      'EUR-BCH': '0.0039636581469648562261',
      'XLM-EUR': '0.078322145',
      'EUR-XLM': '12.5372644131170734172109',
      'DASH-EUR': '97.564735',
      'EUR-DASH': '0.01004717363135730482495',
      'ZEC-EUR': '49.3074',
      'EUR-ZEC': '0.019969818913480885309375',
      'EUR-USD': '1.113729905',
      'USD-EUR': '0.88446601422631279708285',
      'EUR-ZCN': '11.13729905',
      'ZCN-EUR': '0.0884466014226312797063',
    },
    ask: {
      'BTC-EUR': '5413.19675',
      'EUR-BTC': '0.000187518612269207866725',
      'ETH-EUR': '150.591025',
      'EUR-ETH': '0.0067418361884368308346',
      'LTC-EUR': '65.78975',
      'EUR-LTC': '0.01545956728556084088075',
      'REP-EUR': '17.4509075',
      'EUR-REP': '0.0583314034275127373764',
      'XRP-EUR': '0.265043025',
      'EUR-XRP': '3.833276262222729520984175',
      'BCH-EUR': '252.278',
      'EUR-BCH': '0.004026778577138289368175',
      'XLM-EUR': '0.07975773',
      'EUR-XLM': '12.767062878576678409407475',
      'DASH-EUR': '99.52488',
      'EUR-DASH': '0.010249028503997884075475',
      'ZEC-EUR': '50.07275',
      'EUR-ZEC': '0.020279790660225442837075',
      'EUR-USD': '1.130562095',
      'USD-EUR': '0.89783325877381374615715',
      'EUR-ZCN': '11.30562095',
      'ZCN-EUR': '0.0897833258773813746137',
    },
    change: {
      'BTC-EUR': '2.146387832699619772',
      'EUR-BTC': '-2.146387832699619772',
      'ETH-EUR': '-0.618351063829787234',
      'EUR-ETH': '0.618351063829787234',
      'LTC-EUR': '-0.443018637335777574',
      'EUR-LTC': '0.443018637335777574',
      'REP-EUR': '-2.002268859897901305',
      'EUR-REP': '2.002268859897901305',
      'XRP-EUR': '-0.967547624425871546',
      'EUR-XRP': '0.967547624425871546',
      'BCH-EUR': '-0.436681222707423581',
      'EUR-BCH': '0.436681222707423581',
      'XLM-EUR': '-3.606725395934503038',
      'EUR-XLM': '3.606725395934503038',
      'DASH-EUR': '-4.913342132390485457',
      'EUR-DASH': '4.913342132390485457',
      'ZEC-EUR': '-3.100019496977968415',
      'EUR-ZEC': '3.100019496977968415',
    },
    median: {
      'BTC-EUR': '5372.850375',
      'EUR-BTC': '0.0001861209730184097',
      'ETH-EUR': '149.4551125',
      'EUR-ETH': '0.00669098232115358635',
      'LTC-EUR': '65.2354875',
      'EUR-LTC': '0.01532932422470997634',
      'REP-EUR': '17.29668375',
      'EUR-REP': '0.05781589512060354841',
      'XRP-EUR': '0.2629509',
      'EUR-XRP': '3.80301818204837772282',
      'BCH-EUR': '250.30075',
      'EUR-BCH': '0.0039952183620515728',
      'XLM-EUR': '0.0790399375',
      'EUR-XLM': '12.65216364584687591331',
      'DASH-EUR': '98.5448075',
      'EUR-DASH': '0.01014810106767759445',
      'ZEC-EUR': '49.690075',
      'EUR-ZEC': '0.02012480478685316407',
      'EUR-USD': '1.122146',
      'USD-EUR': '0.89114963650006327162',
      'EUR-ZCN': '11.22146',
      'ZCN-EUR': '0.08911496365000632716',
    },
  };
}

// endregion